# ------------------  INPUTS TO MAIN PROGRAM  -------------------
# Re_tau = h = 395

erf.anelastic = 1
erf.use_fft   = true

stop_time = 20.0 # nondimensional time, t * utau / h

#amrex.fpe_trap_invalid = 1

# PROBLEM SIZE & GEOMETRY
# tanh grid clustering (a=0.980, Abe et al. 2001)
# dx+ = 10  dy+ = 6.5  dz+ ~ 0.39 to 9.6 (initial stretching ~ 1.05)
geometry.prob_extent =  6.2831853072  3.1415926536  2  # normalized by h
amr.n_cell           =  256  192  192

erf.terrain_z_levels = 0.0 0.0009901186357416103 0.0020277402552070223 0.0031150909668699045 0.004254495950352544 0.005448383342348206 0.006699288221553856 0.008009856689175754 0.009382850040701718 0.010821149023665932 0.012327758175069814 0.013905810230945725 0.01555857059925636 0.01728944188590964 0.019101968462114316 0.020999841059613722 0.022986901378492908 0.02506714669025567 0.02724473441670472 0.029523986662825075 0.03190939467934828 0.034405623227981796 0.03701751481938731 0.03975009379091221 0.04260857018778785 0.04559834340803237 0.04872500556761339 0.05199434453856511 0.055412346608695096 0.05898519870730101 0.062719290136936 0.06662121374674734 0.07069776647829185 0.07495594921003546 0.07940296582199924 0.08404622139729878 0.08889331947265533 0.09395205824542319 0.099230425640358 0.10473659313530403 0.11047890824132789 0.11646588552966763 0.12270619609531708 0.12920865534526071 0.1359822089984719 0.1430359171849087 0.15037893653209677 0.15802050013062385 0.1659698952741817 0.17423643887586937 0.182829450470524 0.1917582227230331 0.20103198937515065 0.21065989057841294 0.22065093557854343 0.23101396273737607 0.24175759690192833 0.2528902041569191 0.2644198440267804 0.2763542192260403 0.28870062309278877 0.30146588487862425 0.3146563131097847 0.3282776372777756 0.3423349481633098 0.3568326371442274 0.37177433488567446 0.387162849858426 0.40300010717801016 0.419287088302286 0.436023772167322 0.4532090783796713 0.47084081311631965 0.4889156184104507 0.5074289255205149 0.5263749130907518 0.5457464708121187 0.5655351692825328 0.5857312367435481 0.6063235433363539 0.627299593472832 0.64864552685716 0.6703461286201655 0.6923848489427659 0.7147438324471449 0.7374039575259523 0.7603448856622225 0.7835451206677779 0.806982077637682 0.8306321612852667 0.8544708531890031 0.8784728073517422 0.9026119533474649 0.9268616062134648 0.9511945821395512 0.9755833189129118 1.0 1.0244166810870885 1.0488054178604485 1.073138393786535 1.0973880466525354 1.1215271926482575 1.145529146810997 1.1693678387147335 1.1930179223623179 1.216454879332222 1.2396551143377779 1.2625960424740474 1.285256167552855 1.3076151510572345 1.329653871379834 1.35135447314284 1.3727004065271682 1.393676456663646 1.414268763256452 1.4344648307174674 1.454253529187881 1.4736250869092482 1.4925710744794853 1.5110843815895492 1.5291591868836805 1.546790921620329 1.5639762278326779 1.5807129116977139 1.59699989282199 1.6128371501415737 1.6282256651143254 1.6431673628557728 1.65766505183669 1.6717223627222244 1.6853436868902154 1.6985341151213755 1.7112993769072111 1.7236457807739598 1.7355801559732194 1.7471097958430808 1.758242403098072 1.7689860372626238 1.7793490644214565 1.789340109421587 1.7989680106248493 1.808241777276967 1.817170549529476 1.8257635611241305 1.8340301047258183 1.8419794998693761 1.8496210634679033 1.8569640828150913 1.864017791001528 1.8707913446547393 1.877293803904683 1.8835341144703324 1.889521091758672 1.895263406864696 1.900769574359642 1.9060479417545768 1.9111066805273447 1.9159537786027012 1.9205970341780008 1.9250440507899644 1.929302233521708 1.9333787862532525 1.937280709863064 1.9410148012926989 1.944587653391305 1.948005655461435 1.9512749944323866 1.9544016565919677 1.9573914298122121 1.960249906209088 1.9629824851806128 1.9655943767720183 1.9680906053206517 1.970476013337175 1.9727552655832952 1.9749328533097446 1.977013098621507 1.9790001589403863 1.980898031537886 1.9827105581140905 1.9844414294007438 1.9860941897690543 1.9876722418249302 1.9891788509763342 1.9906171499592982 1.9919901433108242 1.993300711778446 1.9945516166576518 1.9957455040496475 1.9968849090331302 1.997972259744793 1.9990098813642585 2.0

geometry.is_periodic = 1 1 0

zlo.type        = NoSlipWall
zhi.type        = NoSlipWall

erf.init_type = uniform

# TIME STEP CONTROL
#erf.cfl = 0.5
erf.fixed_dt        = 0.00015  # based on viscous CFL limit, 2*dt/(Re_tau * dz^2) < 0.75

# DIAGNOSTICS & VERBOSITY
erf.sum_interval   = 1       # timesteps between computing mass
erf.v              = 1       # verbosity in ERF.cpp
amr.v              = 1       # verbosity in Amr.cpp
erf.mg_v           = 1

# planar averaging
erf.data_log    = surf_hist.dat mean_profiles.dat flux_profiles.dat
erf.profile_int = 20
erf.destag_profiles = false

# REFINEMENT / REGRIDDING
amr.max_level       = 0       # maximum level number allowed

# CHECKPOINT FILES
erf.check_file      = chk        # root name of checkpoint file
erf.check_int       = 1000       # number of timesteps between checkpoints

# PLOTFILES
erf.plot_file_1     = plt       # prefix of plotfile name
erf.plot_int_1      = 100       # number of timesteps between plotfiles
erf.plot_vars_1     = x_velocity y_velocity z_velocity
erf.plot_vars_1     = x_velocity y_velocity z_velocity theta pert_pres dpdx dpdy dpdz

# SOLVER CHOICE
erf.dycore_horiz_adv_type   = "Blended_5th6th"
erf.dycore_horiz_upw_frac   = 0.2
erf.dycore_vert_adv_type    = "Blended_5th6th"
erf.dycore_vert_upw_frac    = 0.2

erf.use_gravity = false
erf.use_coriolis = false

erf.molec_diff_type = "Constant"
erf.dynamic_viscosity = 0.00253164557 # == 1 / Re_tau

#erf.abl_driver_type = "PressureGradient"
#erf.abl_pressure_grad = -0.1329113924 0 0 # dp/dx == -2 * u_0 / Re_tau

# maintain bulk velocity â‰ˆ 17.54 (from integrating MKM99 ref profile)
erf.const_massflux_x = 110.2369226035554
erf.const_massflux_tau = 0.005 # ad hoc timescale for background pressure adjustment

# INITIALIZATION
prob.rho_0 = 1.0
prob.T_0 = 300.

# Poiseuille profile
prob.prob_type = 21 # normal dir in z
prob.u_0 = 26.25    # centerline vel

# divergence free perturbations
prob.pert_delta_u = 2.625
prob.pert_delta_v = 2.625
prob.pert_periods_u = 10
prob.pert_periods_v = 10
